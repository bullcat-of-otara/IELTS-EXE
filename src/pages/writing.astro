---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";

const allWriting = await getCollection("writing");
---

<Layout title="IELTS.EXE | Writing Hub">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <div class="text-center mb-16">
      <h1 class="text-4xl md:text-5xl font-bold mb-4">
        <span
          class="bg-clip-text text-transparent bg-gradient-to-r from-neon-cyan to-neon-indigo"
        >
          Writing Hub
        </span>
      </h1>
      <p class="text-slate-400 max-w-2xl mx-auto text-lg">
        Deep dives, strategies, and band-score secrets to help you ace your
        exam.
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {
        allWriting.map((post) => {
          const wordCount = post.body ? post.body.split(/\s+/g).length : 0;
          const readingTime = Math.ceil(wordCount / 200);

          return (
            <article class="flex flex-col h-full bg-slate-800/50 rounded-2xl border border-slate-700/50 hover:border-neon-cyan/50 transition-all duration-300 group cursor-pointer backdrop-blur-sm shadow-lg overflow-hidden relative">
              <div class="absolute top-0 right-0 p-4">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-700 text-neon-cyan border border-slate-600">
                  {readingTime} min read
                </span>
              </div>

              <div class="p-6 flex-grow flex flex-col">
                <div class="mb-4">
                  {post.data.pubDate && (
                    <time
                      datetime={post.data.pubDate.toISOString()}
                      class="text-xs text-slate-500 uppercase tracking-wider font-semibold"
                    >
                      {post.data.pubDate.toLocaleDateString(undefined, {
                        year: "numeric",
                        month: "long",
                        day: "numeric",
                      })}
                    </time>
                  )}
                </div>

                <a href={`/writing/${post.slug}`} class="block flex-grow">
                  <h2 class="text-xl font-bold mb-3 text-slate-100 group-hover:text-neon-cyan transition-colors leading-tight">
                    {post.data.title}
                  </h2>
                  {post.data.description && (
                    <p class="text-slate-400 text-sm line-clamp-3 leading-relaxed mb-4">
                      {post.data.description}
                    </p>
                  )}
                </a>

                <div class="mt-auto pt-4 border-t border-slate-700/50 flex items-center justify-between">
                  <span class="text-sm text-slate-500 font-medium">
                    {post.data.author || "Contributor"}
                  </span>
                  <span class="text-neon-indigo font-semibold text-sm group-hover:translate-x-1 transition-transform flex items-center gap-1">
                    Read Article &rarr;
                  </span>
                </div>
              </div>
            </article>
          );
        })
      }
    </div>

    {
      allWriting.length === 0 && (
        <div class="text-center text-slate-500 py-20">
          <p class="text-xl">No guides available yet. Check back soon!</p>
        </div>
      )
    }
  </div>
</Layout>
